name: Unit Tests and Integration Tests

trigger:
  - master

pool:
  vmImage: ubuntu-latest

stages:
  - stage: NET_Tests
    jobs:
      - job: ut
        displayName: Run unit tests
        steps:
          - task: DotNetCoreCLI@2
            displayName: Run unit tests
            inputs:
              workingDirectory: $(Agent.BuildDirectory)/s/src/SocketIOClient.UnitTest
              command: test
      - job:
        displayName: Run integration tests
        dependsOn:
          - ut
        steps:
          - template: templates/socket.io-tpl.yml
          - task: DotNetCoreCLI@2
            displayName: Run integration tests
            inputs:
              workingDirectory: $(Agent.BuildDirectory)/s/src/SocketIOClient.IntegrationTests
              command: test
  - stage: NET_Framework_Tests
    dependsOn: [ ]
    pool: 
      vmImage: windows-latest
    jobs:
      - job:
        displayName: Run integration tests for .Net Framework
        steps:
          - template: templates/socket.io-tpl.yml
          - task: MSBuild@1
            inputs:
              solution: $(Agent.BuildDirectory)/s/src/socket.io-client-csharp.sln
              restoreNugetPackages: true